module.exports=[4527,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(69240),e=a.i(3130),f=a.i(54161),g=a.i(40695),h=a.i(5522),i=a.i(17171),j=a.i(88237),k=a.i(65733),l=a.i(34308),m=a.i(87532),n=a.i(15618),o=a.i(70106);let p=(0,o.default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var q=a.i(84505),r=a.i(24569);let s=(0,o.default)("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),t=(0,o.default)("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);var u=a.i(60246),v=a.i(96221);function w(){let a=(0,c.useRef)(null),[o,w]=(0,c.useState)([]),[x,y]=(0,c.useState)(null),[z,A]=(0,c.useState)(!0),[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)(""),[F,G]=(0,c.useState)(!1),[H,I]=(0,c.useState)(!1),[J,K]=(0,c.useState)(!1),[L,M]=(0,c.useState)(null),N=(0,d.createClient)(),[O,P]=(0,c.useState)({employeeCode:"",cedula:"",name:"",email:"",monthlySalary:""});(0,c.useEffect)(()=>{!async function(){let{data:{user:a}}=await N.auth.getUser();if(!a)return;let{data:b}=await N.from("profiles").select("company_id").eq("id",a.id).single();if(!b?.company_id)return A(!1);let{data:c}=await N.from("companies").select("*").eq("id",b.company_id).single();y(c);let{data:d}=await N.from("employees").select("*").eq("company_id",b.company_id).order("created_at",{ascending:!1});w(d||[]),A(!1)}()},[N]);let Q=x?.availability_percentage||50,R=o.filter(a=>a.full_name.toLowerCase().includes(D.toLowerCase())||a.cedula?.includes(D)||a.employee_code?.toLowerCase().includes(D.toLowerCase())),S=async()=>{if(!x)return;C(!0);let a=(()=>{let a="ABCDEFGHJKMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789",b="";for(let c=0;c<10;c++)b+=a.charAt(Math.floor(Math.random()*a.length));return b})(),b=Number.parseFloat(O.monthlySalary)||0,c=b*Q/100,{data:d,error:e}=await N.from("employees").insert({company_id:x.id,employee_code:O.employeeCode,cedula:O.cedula,full_name:O.name,email:O.email,salary:b,available_balance:c,total_withdrawn:0,status:"active"}).select().single();e?(console.log("[v0] Error adding employee:",e),alert("Error al agregar colaborador: "+e.message)):d&&(w([d,...o]),G(!1),P({employeeCode:"",cedula:"",name:"",email:"",monthlySalary:""}),alert(`Colaborador agregado exitosamente!

Se enviar\xe1 un correo de bienvenida a ${d.email} con:
- Usuario: ${d.email}
- Contrase\xf1a temporal: ${a}`)),C(!1)},T=async()=>{if(!L)return;C(!0);let a=L.salary,b=a*Q/100,{error:c}=await N.from("employees").update({employee_code:L.employee_code,cedula:L.cedula,full_name:L.full_name,email:L.email,salary:a,available_balance:b,updated_at:new Date().toISOString()}).eq("id",L.id);c?(console.log("[v0] Error updating employee:",c),alert("Error al actualizar colaborador")):(w(o.map(a=>a.id===L.id?{...L,available_balance:b}:a)),K(!1),M(null)),C(!1)},U=async(a,b)=>{let c="active"===b?"suspended":"active",{error:d}=await N.from("employees").update({status:c,updated_at:new Date().toISOString()}).eq("id",a);d?(console.log("[v0] Error toggling status:",d),alert("Error al cambiar el estado")):w(o.map(b=>b.id===a?{...b,status:c}:b))};return z?(0,b.jsx)(l.HRLayout,{children:(0,b.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,b.jsx)(v.Loader2,{className:"w-8 h-8 animate-spin text-emerald-600"})})}):(0,b.jsxs)(l.HRLayout,{children:[(0,b.jsx)(e.Card,{className:"mb-6 border-blue-200 bg-blue-50",children:(0,b.jsx)(e.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"text-blue-600 text-xl",children:"i"}),(0,b.jsx)("div",{children:(0,b.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,b.jsx)("strong",{children:"Porcentaje de Retiro:"})," El administrador ha configurado que los colaboradores pueden retirar hasta el ",(0,b.jsxs)("strong",{children:[Q,"%"]})," de su salario. El máximo de retiro se calcula automáticamente."]})})]})})}),(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{children:(0,b.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(e.CardTitle,{className:"text-xl flex items-center gap-2",children:[(0,b.jsx)(u.Users,{className:"w-5 h-5"}),"Gestión de Colaboradores"]}),(0,b.jsx)(e.CardDescription,{children:"Administre sus empleados, configure salarios y vea sus límites de retiro"})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,b.jsxs)(g.Button,{variant:"outline",className:"gap-2 bg-transparent",children:[(0,b.jsx)(q.Download,{className:"w-4 h-4"}),"Descargar Plantilla"]}),(0,b.jsxs)(k.Dialog,{open:H,onOpenChange:I,children:[(0,b.jsx)(k.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(g.Button,{variant:"outline",className:"gap-2 bg-transparent",children:[(0,b.jsx)(p,{className:"w-4 h-4"}),"Cargar Excel"]})}),(0,b.jsxs)(k.DialogContent,{children:[(0,b.jsxs)(k.DialogHeader,{children:[(0,b.jsx)(k.DialogTitle,{children:"Carga Masiva de Colaboradores"}),(0,b.jsx)(k.DialogDescription,{children:"Suba un archivo Excel o CSV con la información de los colaboradores."})]}),(0,b.jsx)("div",{className:"space-y-4 py-4",children:(0,b.jsxs)("div",{className:"border-2 border-dashed border-slate-200 rounded-lg p-8 text-center",children:[(0,b.jsx)(p,{className:"w-12 h-12 text-slate-400 mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-sm text-slate-600 mb-2",children:"Arrastre su archivo aquí o haga clic para seleccionar"}),(0,b.jsx)("p",{className:"text-xs text-slate-400",children:"Formatos soportados: .xlsx, .xls, .csv"}),(0,b.jsx)(h.Input,{ref:a,type:"file",accept:".xlsx,.xls,.csv",className:"hidden"}),(0,b.jsx)(g.Button,{variant:"outline",className:"mt-4 bg-transparent",onClick:()=>a.current?.click(),children:"Seleccionar Archivo"})]})}),(0,b.jsxs)(k.DialogFooter,{children:[(0,b.jsx)(g.Button,{variant:"outline",onClick:()=>I(!1),children:"Cancelar"}),(0,b.jsxs)(g.Button,{className:"bg-emerald-600 hover:bg-emerald-700",children:[(0,b.jsx)(p,{className:"mr-2 h-4 w-4"}),"Procesar Archivo"]})]})]})]}),(0,b.jsxs)(k.Dialog,{open:F,onOpenChange:G,children:[(0,b.jsx)(k.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(g.Button,{className:"gap-2 bg-emerald-600 hover:bg-emerald-700",children:[(0,b.jsx)(n.Plus,{className:"w-4 h-4"}),"Agregar Colaborador"]})}),(0,b.jsxs)(k.DialogContent,{className:"max-w-lg",children:[(0,b.jsxs)(k.DialogHeader,{children:[(0,b.jsx)(k.DialogTitle,{children:"Agregar Nuevo Colaborador"}),(0,b.jsx)(k.DialogDescription,{children:"Complete los datos del colaborador. Se generará una contraseña automática y se enviará por correo."})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Código de Empleado *"}),(0,b.jsx)(h.Input,{placeholder:"EMP-001",value:O.employeeCode,onChange:a=>P({...O,employeeCode:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Cédula *"}),(0,b.jsx)(h.Input,{placeholder:"001-1234567-8",value:O.cedula,onChange:a=>P({...O,cedula:a.target.value})})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Nombre Completo *"}),(0,b.jsx)(h.Input,{placeholder:"María Rodríguez",value:O.name,onChange:a=>P({...O,name:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Correo Electrónico *"}),(0,b.jsx)(h.Input,{type:"email",placeholder:"maria@empresa.com",value:O.email,onChange:a=>P({...O,email:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Salario Mensual (RD$) *"}),(0,b.jsx)(h.Input,{type:"number",placeholder:"25000",value:O.monthlySalary,onChange:a=>P({...O,monthlySalary:a.target.value})}),O.monthlySalary&&(0,b.jsxs)("p",{className:"text-xs text-emerald-600",children:["Máximo de retiro: RD$"," ",(Number.parseFloat(O.monthlySalary)*Q/100).toLocaleString()," ","(",Q,"% del salario)"]})]})]}),(0,b.jsxs)(k.DialogFooter,{children:[(0,b.jsx)(g.Button,{variant:"outline",onClick:()=>G(!1),children:"Cancelar"}),(0,b.jsxs)(g.Button,{className:"bg-emerald-600 hover:bg-emerald-700",onClick:S,disabled:!O.name||!O.cedula||!O.email||!O.monthlySalary||B,children:[B?(0,b.jsx)(v.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):(0,b.jsx)(n.Plus,{className:"mr-2 h-4 w-4"}),"Agregar Colaborador"]})]})]})]})]})]})}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsx)("div",{className:"mb-6",children:(0,b.jsxs)("div",{className:"relative max-w-sm",children:[(0,b.jsx)(m.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-slate-400"}),(0,b.jsx)(h.Input,{placeholder:"Buscar por nombre, cédula o código...",className:"pl-10",value:D,onChange:a=>E(a.target.value)})]})}),(0,b.jsx)("div",{className:"rounded-lg border overflow-hidden",children:(0,b.jsxs)(j.Table,{children:[(0,b.jsx)(j.TableHeader,{children:(0,b.jsxs)(j.TableRow,{className:"bg-slate-50",children:[(0,b.jsx)(j.TableHead,{children:"Código"}),(0,b.jsx)(j.TableHead,{children:"Colaborador"}),(0,b.jsx)(j.TableHead,{children:"Cédula"}),(0,b.jsx)(j.TableHead,{children:"Salario"}),(0,b.jsx)(j.TableHead,{children:"Máx. Retiro"}),(0,b.jsx)(j.TableHead,{children:"Estado"}),(0,b.jsx)(j.TableHead,{className:"text-right",children:"Acciones"})]})}),(0,b.jsx)(j.TableBody,{children:0===R.length?(0,b.jsx)(j.TableRow,{children:(0,b.jsx)(j.TableCell,{colSpan:7,className:"text-center py-8 text-slate-500",children:"No hay colaboradores registrados"})}):R.map(a=>{let c=a.salary*Q/100;return(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableCell,{className:"font-mono text-sm",children:a.employee_code||"-"}),(0,b.jsx)(j.TableCell,{children:(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:a.full_name}),(0,b.jsx)("div",{className:"text-xs text-slate-500",children:a.email})]})}),(0,b.jsx)(j.TableCell,{className:"font-mono text-sm",children:a.cedula||"-"}),(0,b.jsxs)(j.TableCell,{children:["RD$ ",a.salary.toLocaleString()]}),(0,b.jsx)(j.TableCell,{children:(0,b.jsxs)(f.Badge,{className:"bg-emerald-100 text-emerald-700",children:["RD$ ",c.toLocaleString()]})}),(0,b.jsx)(j.TableCell,{children:(0,b.jsx)(f.Badge,{className:"active"===a.status?"bg-emerald-100 text-emerald-700":"bg-red-100 text-red-700",children:"active"===a.status?"Activo":"Suspendido"})}),(0,b.jsx)(j.TableCell,{className:"text-right",children:(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",onClick:()=>{M({...a}),K(!0)},children:[(0,b.jsx)(r.Edit,{className:"w-3 h-3 mr-1"}),"Editar"]}),(0,b.jsx)(g.Button,{variant:"active"===a.status?"destructive":"default",size:"sm",onClick:()=>U(a.id,a.status),children:"active"===a.status?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(s,{className:"w-3 h-3 mr-1"}),"Suspender"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(t,{className:"w-3 h-3 mr-1"}),"Activar"]})})]})})]},a.id)})})]})})]})]}),(0,b.jsx)(k.Dialog,{open:J,onOpenChange:K,children:(0,b.jsxs)(k.DialogContent,{children:[(0,b.jsxs)(k.DialogHeader,{children:[(0,b.jsx)(k.DialogTitle,{children:"Editar Colaborador"}),(0,b.jsx)(k.DialogDescription,{children:"Modifique la información del colaborador."})]}),L&&(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Código de Empleado"}),(0,b.jsx)(h.Input,{value:L.employee_code||"",onChange:a=>M({...L,employee_code:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Cédula"}),(0,b.jsx)(h.Input,{value:L.cedula||"",onChange:a=>M({...L,cedula:a.target.value})})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Nombre Completo"}),(0,b.jsx)(h.Input,{value:L.full_name,onChange:a=>M({...L,full_name:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Correo Electrónico"}),(0,b.jsx)(h.Input,{type:"email",value:L.email,onChange:a=>M({...L,email:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Salario Mensual (RD$)"}),(0,b.jsx)(h.Input,{type:"number",value:L.salary,onChange:a=>M({...L,salary:Number.parseFloat(a.target.value)||0})}),(0,b.jsxs)("p",{className:"text-xs text-emerald-600",children:["Máximo de retiro: RD$"," ",(L.salary*Q/100).toLocaleString()," (",Q,"% del salario)"]})]})]}),(0,b.jsxs)(k.DialogFooter,{children:[(0,b.jsx)(g.Button,{variant:"outline",onClick:()=>K(!1),children:"Cancelar"}),(0,b.jsxs)(g.Button,{className:"bg-emerald-600 hover:bg-emerald-700",onClick:T,disabled:B,children:[B?(0,b.jsx)(v.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Guardar Cambios"]})]})]})})]})}a.s(["default",()=>w],4527)}];

//# sourceMappingURL=app_hr_colaboradores_page_tsx_9369d9e9._.js.map