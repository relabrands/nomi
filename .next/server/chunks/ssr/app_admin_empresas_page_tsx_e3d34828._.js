module.exports=[98978,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(69240),e=a.i(3130),f=a.i(54161),g=a.i(40695),h=a.i(5522),i=a.i(17171),j=a.i(88237),k=a.i(87682),l=a.i(65733),m=a.i(60593),n=a.i(15618),o=a.i(24569),p=a.i(87532),q=a.i(67900),r=a.i(73570),s=a.i(96221);function t(){let[a,t]=(0,c.useState)([]),[u,v]=(0,c.useState)({}),[w,x]=(0,c.useState)(!0),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)(null),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)(!1),[G,H]=(0,c.useState)(!1),I=(0,d.createClient)(),[J,K]=(0,c.useState)({creditLimit:"",withdrawalPercentage:"",paymentFrequency:"biweekly"}),[L,M]=(0,c.useState)({name:"",rnc:"",email:"",phone:"",creditLimit:"",withdrawalPercentage:"50",withdrawalLimitPerEmployee:"",paymentFrequency:"biweekly"});(0,c.useEffect)(()=>{!async function(){let{data:a,error:b}=await I.from("companies").select("*").order("created_at",{ascending:!1});if(b)return console.log("[v0] Error fetching companies:",b);if(t(a||[]),a){let b={};for(let c of a){let{count:a}=await I.from("employees").select("*",{count:"exact",head:!0}).eq("company_id",c.id);b[c.id]=a||0}v(b)}x(!1)}()},[I]);let N=a.filter(a=>a.name.toLowerCase().includes(y.toLowerCase())||a.rnc?.includes(y)),O=async()=>{if(!A)return;H(!0);let{error:b}=await I.from("companies").update({credit_limit:Number.parseFloat(J.creditLimit)||A.credit_limit,availability_percentage:Number.parseInt(J.withdrawalPercentage)||A.availability_percentage,payment_frequency:J.paymentFrequency,updated_at:new Date().toISOString()}).eq("id",A.id);b?(console.log("[v0] Error updating company:",b),alert("Error al actualizar la empresa")):(t(a.map(a=>a.id===A.id?{...a,credit_limit:Number.parseFloat(J.creditLimit)||a.credit_limit,availability_percentage:Number.parseInt(J.withdrawalPercentage)||a.availability_percentage,payment_frequency:J.paymentFrequency}:a)),D(!1),B(null)),H(!1)},P=async()=>{H(!0);let{data:b,error:c}=await I.from("companies").insert({name:L.name,rnc:L.rnc,email:L.email,phone:L.phone||null,credit_limit:Number.parseFloat(L.creditLimit)||1e6,credit_used:0,withdrawal_limit_per_employee:Number.parseFloat(L.withdrawalLimitPerEmployee)||5e4,availability_percentage:Number.parseInt(L.withdrawalPercentage)||50,payment_frequency:L.paymentFrequency,status:"active",allow_weekend_withdrawals:!1,payroll_cutoff_days:3}).select().single();c?(console.log("[v0] Error creating company:",c),alert("Error al crear la empresa: "+c.message)):b&&(t([b,...a]),F(!1),M({name:"",rnc:"",email:"",phone:"",creditLimit:"",withdrawalPercentage:"50",withdrawalLimitPerEmployee:"",paymentFrequency:"biweekly"})),H(!1)},Q=async(b,c)=>{let d="active"===c?"suspended":"active",{error:e}=await I.from("companies").update({status:d,updated_at:new Date().toISOString()}).eq("id",b);e?(console.log("[v0] Error toggling company status:",e),alert("Error al cambiar el estado de la empresa")):t(a.map(a=>a.id===b?{...a,status:d}:a))};return w?(0,b.jsx)(m.AdminLayout,{children:(0,b.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,b.jsx)(s.Loader2,{className:"w-8 h-8 animate-spin text-emerald-600"})})}):(0,b.jsxs)(m.AdminLayout,{children:[(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{children:(0,b.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(e.CardTitle,{className:"text-xl flex items-center gap-2",children:[(0,b.jsx)(q.Building2,{className:"w-5 h-5"}),"Gestión de Empresas"]}),(0,b.jsx)(e.CardDescription,{children:"Administre empresas clientes, límites de crédito y porcentajes de retiro"})]}),(0,b.jsxs)(l.Dialog,{open:E,onOpenChange:F,children:[(0,b.jsx)(l.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(g.Button,{className:"bg-emerald-600 hover:bg-emerald-700",children:[(0,b.jsx)(n.Plus,{className:"mr-2 h-4 w-4"}),"Agregar Empresa"]})}),(0,b.jsxs)(l.DialogContent,{className:"max-w-lg",children:[(0,b.jsxs)(l.DialogHeader,{children:[(0,b.jsx)(l.DialogTitle,{children:"Agregar Nueva Empresa"}),(0,b.jsx)(l.DialogDescription,{children:"Configure todos los parámetros para la nueva empresa cliente."})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4 max-h-[60vh] overflow-y-auto",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{htmlFor:"company-name",children:"Nombre de Empresa *"}),(0,b.jsx)(h.Input,{id:"company-name",placeholder:"Ej: Call Center RD",value:L.name,onChange:a=>M({...L,name:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{htmlFor:"company-rnc",children:"RNC *"}),(0,b.jsx)(h.Input,{id:"company-rnc",placeholder:"Ej: 101-234567-8",value:L.rnc,onChange:a=>M({...L,rnc:a.target.value})})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{htmlFor:"contact-email",children:"Correo de Contacto *"}),(0,b.jsx)(h.Input,{id:"contact-email",type:"email",placeholder:"rrhh@empresa.com",value:L.email,onChange:a=>M({...L,email:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{htmlFor:"phone",children:"Teléfono"}),(0,b.jsx)(h.Input,{id:"phone",placeholder:"809-555-1234",value:L.phone,onChange:a=>M({...L,phone:a.target.value})})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{htmlFor:"credit-limit",children:"Límite de Crédito (RD$) *"}),(0,b.jsx)(h.Input,{id:"credit-limit",type:"number",placeholder:"5000000",value:L.creditLimit,onChange:a=>M({...L,creditLimit:a.target.value})}),(0,b.jsx)("p",{className:"text-xs text-slate-500",children:"Capital máximo que Nomi desplegará para esta empresa"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{htmlFor:"withdrawal-limit",children:"Límite por Colaborador (RD$)"}),(0,b.jsx)(h.Input,{id:"withdrawal-limit",type:"number",placeholder:"50000",value:L.withdrawalLimitPerEmployee,onChange:a=>M({...L,withdrawalLimitPerEmployee:a.target.value})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"% Retiro para Colaboradores"}),(0,b.jsxs)(k.Select,{value:L.withdrawalPercentage,onValueChange:a=>M({...L,withdrawalPercentage:a}),children:[(0,b.jsx)(k.SelectTrigger,{children:(0,b.jsx)(k.SelectValue,{})}),(0,b.jsxs)(k.SelectContent,{children:[(0,b.jsx)(k.SelectItem,{value:"30",children:"30% del salario"}),(0,b.jsx)(k.SelectItem,{value:"50",children:"50% del salario"}),(0,b.jsx)(k.SelectItem,{value:"80",children:"80% del salario"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Frecuencia de Pago"}),(0,b.jsxs)(k.Select,{value:L.paymentFrequency,onValueChange:a=>M({...L,paymentFrequency:a}),children:[(0,b.jsx)(k.SelectTrigger,{children:(0,b.jsx)(k.SelectValue,{})}),(0,b.jsxs)(k.SelectContent,{children:[(0,b.jsx)(k.SelectItem,{value:"weekly",children:"Semanal"}),(0,b.jsx)(k.SelectItem,{value:"biweekly",children:"Quincenal"}),(0,b.jsx)(k.SelectItem,{value:"monthly",children:"Mensual"})]})]})]})]})]}),(0,b.jsxs)(l.DialogFooter,{children:[(0,b.jsx)(g.Button,{variant:"outline",onClick:()=>F(!1),children:"Cancelar"}),(0,b.jsxs)(g.Button,{className:"bg-emerald-600 hover:bg-emerald-700",onClick:P,disabled:!L.name||!L.rnc||!L.creditLimit||!L.email||G,children:[G?(0,b.jsx)(s.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):(0,b.jsx)(n.Plus,{className:"mr-2 h-4 w-4"}),"Crear Empresa"]})]})]})]})]})}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsx)("div",{className:"mb-6",children:(0,b.jsxs)("div",{className:"relative max-w-sm",children:[(0,b.jsx)(p.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-slate-400"}),(0,b.jsx)(h.Input,{placeholder:"Buscar por nombre o RNC...",className:"pl-10",value:y,onChange:a=>z(a.target.value)})]})}),(0,b.jsx)("div",{className:"rounded-lg border overflow-hidden",children:(0,b.jsxs)(j.Table,{children:[(0,b.jsx)(j.TableHeader,{children:(0,b.jsxs)(j.TableRow,{className:"bg-slate-50",children:[(0,b.jsx)(j.TableHead,{children:"Empresa"}),(0,b.jsx)(j.TableHead,{children:"RNC"}),(0,b.jsx)(j.TableHead,{children:"Límite Crédito"}),(0,b.jsx)(j.TableHead,{children:"Uso Capital"}),(0,b.jsx)(j.TableHead,{children:"% Retiro"}),(0,b.jsx)(j.TableHead,{children:"Frecuencia"}),(0,b.jsx)(j.TableHead,{children:"Estado"}),(0,b.jsx)(j.TableHead,{className:"text-right",children:"Acciones"})]})}),(0,b.jsx)(j.TableBody,{children:0===N.length?(0,b.jsx)(j.TableRow,{children:(0,b.jsx)(j.TableCell,{colSpan:8,className:"text-center py-8 text-slate-500",children:"No hay empresas registradas"})}):N.map(a=>{let c=a.credit_limit>0?a.credit_used/a.credit_limit*100:0,d=c>=80;return(0,b.jsxs)(j.TableRow,{children:[(0,b.jsx)(j.TableCell,{children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-sm font-medium",children:a.name.charAt(0)}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:a.name}),(0,b.jsxs)("div",{className:"text-xs text-slate-500",children:[u[a.id]||0," colaboradores"]})]})]})}),(0,b.jsx)(j.TableCell,{className:"font-mono text-sm",children:a.rnc||"-"}),(0,b.jsxs)(j.TableCell,{children:["RD$ ",(a.credit_limit/1e6).toFixed(1),"M"]}),(0,b.jsx)(j.TableCell,{children:(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("span",{className:d?"text-amber-600 font-medium":"",children:[c.toFixed(0),"%"]}),d&&(0,b.jsx)(r.AlertTriangle,{className:"w-3 h-3 text-amber-500"})]}),(0,b.jsx)("div",{className:"w-24 h-2 bg-slate-100 rounded-full overflow-hidden",children:(0,b.jsx)("div",{className:`h-full rounded-full ${c>=90?"bg-red-500":c>=80?"bg-amber-500":"bg-emerald-500"}`,style:{width:`${Math.min(c,100)}%`}})})]})}),(0,b.jsx)(j.TableCell,{children:(0,b.jsxs)(f.Badge,{className:"bg-emerald-100 text-emerald-700",children:[a.availability_percentage,"%"]})}),(0,b.jsx)(j.TableCell,{className:"capitalize",children:"weekly"===a.payment_frequency?"Semanal":"biweekly"===a.payment_frequency?"Quincenal":"Mensual"}),(0,b.jsx)(j.TableCell,{children:(0,b.jsx)(f.Badge,{className:"active"===a.status?"bg-emerald-100 text-emerald-700":"bg-red-100 text-red-700",children:"active"===a.status?"Activa":"Suspendida"})}),(0,b.jsx)(j.TableCell,{className:"text-right",children:(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",onClick:()=>{B(a),K({creditLimit:a.credit_limit.toString(),withdrawalPercentage:a.availability_percentage.toString(),paymentFrequency:a.payment_frequency}),D(!0)},children:[(0,b.jsx)(o.Edit,{className:"w-3 h-3 mr-1"}),"Editar"]}),(0,b.jsx)(g.Button,{variant:"active"===a.status?"destructive":"default",size:"sm",onClick:()=>Q(a.id,a.status),children:"active"===a.status?"Suspender":"Activar"})]})})]},a.id)})})]})})]})]}),(0,b.jsx)(l.Dialog,{open:C,onOpenChange:D,children:(0,b.jsxs)(l.DialogContent,{children:[(0,b.jsxs)(l.DialogHeader,{children:[(0,b.jsxs)(l.DialogTitle,{children:["Editar ",A?.name]}),(0,b.jsx)(l.DialogDescription,{children:"Modifique los parámetros de crédito y configuración de la empresa."})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Límite de Crédito (RD$)"}),(0,b.jsx)(h.Input,{type:"number",value:J.creditLimit,onChange:a=>K({...J,creditLimit:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"% Retiro para Colaboradores"}),(0,b.jsxs)(k.Select,{value:J.withdrawalPercentage,onValueChange:a=>K({...J,withdrawalPercentage:a}),children:[(0,b.jsx)(k.SelectTrigger,{children:(0,b.jsx)(k.SelectValue,{})}),(0,b.jsxs)(k.SelectContent,{children:[(0,b.jsx)(k.SelectItem,{value:"30",children:"30% del salario"}),(0,b.jsx)(k.SelectItem,{value:"50",children:"50% del salario"}),(0,b.jsx)(k.SelectItem,{value:"80",children:"80% del salario"})]})]}),(0,b.jsx)("p",{className:"text-xs text-slate-500",children:"Este porcentaje aplica a todos los colaboradores de la empresa"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{children:"Frecuencia de Pago"}),(0,b.jsxs)(k.Select,{value:J.paymentFrequency,onValueChange:a=>K({...J,paymentFrequency:a}),children:[(0,b.jsx)(k.SelectTrigger,{children:(0,b.jsx)(k.SelectValue,{})}),(0,b.jsxs)(k.SelectContent,{children:[(0,b.jsx)(k.SelectItem,{value:"weekly",children:"Semanal"}),(0,b.jsx)(k.SelectItem,{value:"biweekly",children:"Quincenal"}),(0,b.jsx)(k.SelectItem,{value:"monthly",children:"Mensual"})]})]})]})]}),(0,b.jsxs)(l.DialogFooter,{children:[(0,b.jsx)(g.Button,{variant:"outline",onClick:()=>D(!1),children:"Cancelar"}),(0,b.jsxs)(g.Button,{className:"bg-emerald-600 hover:bg-emerald-700",onClick:O,disabled:G,children:[G?(0,b.jsx)(s.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Guardar Cambios"]})]})]})})]})}a.s(["default",()=>t])}];

//# sourceMappingURL=app_admin_empresas_page_tsx_e3d34828._.js.map